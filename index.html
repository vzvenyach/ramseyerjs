<!DOCTYPE html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
    del {
        font-weight: bold;
    }
    ins {
        font-weight: bold;
    }
    </style>
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/main.css">

    <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
</head>

<body>

    <div class="container">

        <h1>ramseyer.js</h1>
        <form class="form-inline" role="form">
            <div class="form-group">
                <label class="sr-only" for="sectionGetter">Get a section of the Code</label>
                <input type="search" class="form-control" id="sectionGetter" placeholder="Get a section">
            </div>
            <button class="btn btn-default" id="sectionGetterBtn">Go</button>
            <button class="btn btn-default" id="differBtn">Differ</button>
        </form>
        <div class="form-group">
            <div class="row">
                <div class="col-md-6">
                    <h2>Original Provision</h2>
                    <div id="original" class="sectioncontainer" contenteditable="true" style="width: 90%; height: 20em; word-wrap: break-word;"></div>
                </div>
                <div class="col-md-6">
                    <h2>New Provision</h2>
                    <div id="new" class="sectioncontainer" contenteditable="true" style="width: 90%; height: 20em; word-wrap: break-word;"></div>
                </div>
            </div>

        </div>
    </div>
    <!-- /container -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script>
    window.jQuery || document.write('<script src="./js/vendor/jquery-1.10.1.min.js"><\/script>')
    </script>

    <script src="js/vendor/bootstrap.min.js"></script>

    <script src="js/main.js"></script>
    <script src="js/vendor/diff.js"></script>
    <script type="text/javascript">
    function htmlEscape(str) {
        return String(str)
            .replace(/&amp;/g, '&')
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, "'")
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>');
    }

    $("#sectionGetterBtn").click(function(evt) {
        evt.preventDefault();
        $(".sectioncontainer").html("");
        var s = $("#sectionGetter").val();
        var p = s.indexOf("-");
        if (p == -1) {
            alert("Search by citation, such as 50-102.");
            return false;
        }
        title = s.substring(0, p);
        sec = s.substring(p + 1);

        $.ajaxSetup({
            headers: {
                'Accept': 'application/vnd.github.v3.raw',
            }
        });

        $.getJSON('https://api.github.com/repos/openlawdc/dccode/contents/by_title/' + title + '.json', function(d) {
            var title_shard = d;
            if (!(sec in title_shard["sec"])) {
                alert("Citation not found.")
                return false;
            }
            section_xml = title_shard["sec"][sec];
            section_url = section_xml.replace('xml', 'html');
            $.get("https://api.github.com/repos/openlawdc/dccode/contents/" + section_url + '?ref=gh-pages', function(x) {
                section = $("#content > *[class!=annotations]", x);
                $(section).appendTo(".sectioncontainer");
            });
        });
    });

    $("#differBtn").click(function(evt) {
        evt.preventDefault();
        var diff = JsDiff.diffWords($("#original").html(), $("#new").html());
        console.log(JsDiff.convertChangesToXML(diff));
        var html_array = [];
        var w = window.open();
        w.document.open("text/html", "replace");
        w.document.write("<HTML><HEAD><STYLE>del {font-weight: bold; } ins {font-weight: bold; }</STYLE><TITLE>Ramseyer</TITLE></HEAD><BODY>" + htmlEscape(JsDiff.convertChangesToXML(diff)) + "</BODY></HTML>");
        w.document.close();
    });
    </script>
</body>

</html>
